<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/x-icon" href="/favicon.ico"><title>Create Graphql server in Next.js | Hello, World</title><meta name="description"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_assets/_slug_.5Zos-WDK.css">
<link rel="stylesheet" href="/_assets/_slug_.rCULUuHh.css"></head> <body style="min-height: 100vh; display: flex; flex-direction: column; background-color: #f9fafb;" data-astro-cid-37fxchfa> <div class="container-main" style="flex-grow: 1;" data-astro-cid-37fxchfa> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="brand" data-astro-cid-3ef6ksr2> <a href="/" class="site-title" data-astro-cid-3ef6ksr2>Hello, World</a> <a href="https://webring.wonderful.software#curiousdev.in.th" title="วงแหวนเว็บ" class="webring" data-astro-cid-3ef6ksr2> <img alt="วงแหวนเว็บ" width="32" height="32" src="https://webring.wonderful.software/webring.black.svg" class="webring-image" data-astro-cid-3ef6ksr2> </a> </div> <nav data-astro-cid-3ef6ksr2> <ul class="nav-list" data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/" class="nav-item" data-astro-cid-3ef6ksr2>Home</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/blog" class="nav-item" data-astro-cid-3ef6ksr2>Blog</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/about" class="nav-item" data-astro-cid-3ef6ksr2>About</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/contact" class="nav-item" data-astro-cid-3ef6ksr2>Contact</a> </li> </ul> </nav> </div> </header>  <script type="module" src="/_assets/Header.astro_astro_type_script_index_0_lang.DT_jaKul.js"></script> <main style="padding-top: 2rem; padding-bottom: 2rem;" data-astro-cid-37fxchfa>  <article class="blog-post" data-astro-cid-bvzihdzo> <h1 class="blog-title" data-astro-cid-bvzihdzo>Create Graphql server in Next.js</h1> <time class="blog-date" data-astro-cid-bvzihdzo>November 21, 2020</time> <div class="blog-content" data-astro-cid-bvzihdzo>  <p>สวัสดีครับ วันนี้จะมาแนะนำการสร้าง Graphql server ใน Next.js project กัน หลายคนอาจจะสงสัยนะครับว่า อ้าว Next.js เป็น React Framework ไม่ใช่เหรอ แล้วมันเอามาทำ Graphql server ได้ยังไง ตอนแรกผมก็งงๆ แบบนี้เหมือนกัน แต่ลองไปค้นคว้าเพิ่มเติมดูพบว่า ตั้งแต่ Next.js version 9 เป็นต้นมา เราสามารถสร้าง api route ได้เองใน project ของเราเลย ซึ่งก็สามารถสร้างได้ทั้ง REST api ปกติ หรือว่า Graphql api ก็ได้เช่นกัน ทีนี้มีขั้นตอนการทำยังไง เรามาเริ่มกันเลยครับ</p>
<h2 id="create-nextjs-project">Create Next.js Project</h2>
<p>สร้าง project ขึ้นมาใหม่โดยใช้คำสั่งข้างล่างนี้</p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash">npx create-next-app nextjs-graphql-server-example
</code></pre>
<p>จากนั้นก็เข้าไปที่ project directory แล้วก็ให้มัน run โดยคำสั่ง</p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash"><span class="token builtin class-name">cd</span> nextjs-graphql-server-example
<span class="token function">yarn</span> dev
</code></pre>
<p>แล้วไปที่ <code>http://localhost:3000</code> ก็จะเห็นหน้าตาแบบรูปข้างล่าง</p>
<p><img  src="/_assets/next_start.BEMZvJu6_ZNo4Sj.webp" alt="next start" width="1824" height="1314" loading="lazy" decoding="async"></p>
<h2 id="nextjs-api-route-intruduction">Next.js API Route intruduction</h2>
<p>ทีนี้เราก็เปิด project ขึ้นมาด้วย text editor ผมใช้ vscode นะครับ เราก็จะเห็นโครงสร้าง folder ต่างๆ ประมาณนี้</p>
<p><img  src="/_assets/project_structure.D3FJ_4lM_Z2HIaw.webp" alt="project structure" width="1716" height="984" loading="lazy" decoding="async"></p>
<p>จะเห็นได้ว่ามี folder <code>pages/api</code> อยู่ แล้วข้างในมีไฟล์ที่ชื่อว่า <code>hello.js</code> ถ้าลองเปิดดู จะเห็น code แบบนี้</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token comment">// pages/api/hello.js</span>

<span class="token comment">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>ถ้าใครเคยพัฒนา application ด้วย node.js/express มาก่อน ก็ร้องอ๋อเลยทีเดียว เพราะมันคือการสร้าง express handler นั่นเอง จาก <a href="https://nextjs.org/docs/api-routes/introduction">document</a> เค้าก็จะบอกว่า ถ้าเราสร้างไฟล์ไว้ข้างใน <code>pages/api</code> มันก็จะนำชื่อไฟล์มาสร้างเป็น api route ให้เราเลย ถ้าอยากรู้ว่าหน้าตา response เป็นอย่างไร ก็เข้าไปที่ <code>http://localhost:3000/api/hello</code></p>
<pre class="language-json" data-language="json"><code is:raw="" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="create-graphql-server">Create Graphql server</h2>
<p>ต่อไปก็เป็นการสร้าง Graphql Server นะครับ ขั้นตอนนี้หวังว่าทุกคน พอจะมี basic graphql คร่าวๆ แล้วนะครับ เข้าใจการสร้าง type, Resolvers function อะไรพวกนี้ ก่อนอื่นก็ install dependencies เหล่านี้ก่อนครับ</p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> apollo-server-micro graphql swr axios
or
<span class="token function">yarn</span> <span class="token function">add</span> apollo-server-micro graphql swr axios
</code></pre>
<p>โดยที่</p>
<ul>
<li><code>apollo-server-micro</code>, <code>graphql</code> สำหรับสร้าง Graphql server</li>
<li><code>swr</code>, <code>axios</code> สำหรับ fetch data จาก graphql</li>
</ul>
<p>ทีนี้สร้างไฟล์ <code>graphql.js</code> ข้างใน <code>pages/api</code> และสร้าง Graphql server แบบนี้</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token comment">// graphql.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServer<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-server-micro'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> typeDefs <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  type Query {
    users: [User!]!
  }

  type User {
    firstname: String
    lastname: String
    age: Int
    occupation: String
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">Query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">firstname</span><span class="token operator">:</span> <span class="token string">'Teerapat'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">lastname</span><span class="token operator">:</span> <span class="token string">'Prommarak'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
          <span class="token literal-property property">occupation</span><span class="token operator">:</span> <span class="token string">'Software Engineer'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">firstname</span><span class="token operator">:</span> <span class="token string">'Mesut'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">lastname</span><span class="token operator">:</span> <span class="token string">'Ozil'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
          <span class="token literal-property property">occupation</span><span class="token operator">:</span> <span class="token string">'Professional Footballer'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">firstname</span><span class="token operator">:</span> <span class="token string">'Bill'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">lastname</span><span class="token operator">:</span> <span class="token string">'Gate'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">65</span><span class="token punctuation">,</span>
          <span class="token literal-property property">occupation</span><span class="token operator">:</span> <span class="token string">'Entrepreneur'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> apolloServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">api</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bodyParser</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> apolloServer<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/api/graphql'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>จากนั้นให้เข้าไปที่ <code>http://localhost:3000/api/graphql</code> ก็จะเห็น graphql playground ทีนี้ลอง query เล่นๆ ดูครับ</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript">query <span class="token punctuation">{</span>
  users<span class="token punctuation">{</span>
    firstname
    lastname
    age
    occupation
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>เราก็จะได้ query result ออกมาแบบนี้</p>
<pre class="language-json" data-language="json"><code is:raw="" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"users"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Teerapat"</span><span class="token punctuation">,</span>
        <span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Prommarak"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
        <span class="token property">"occupation"</span><span class="token operator">:</span> <span class="token string">"Software Engineer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Mesut"</span><span class="token punctuation">,</span>
        <span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Ozil"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
        <span class="token property">"occupation"</span><span class="token operator">:</span> <span class="token string">"Professional Footballer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Bill"</span><span class="token punctuation">,</span>
        <span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Gate"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">65</span><span class="token punctuation">,</span>
        <span class="token property">"occupation"</span><span class="token operator">:</span> <span class="token string">"Entrepreneur"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ความสะดวกของ graphql query ก็คือในกรณีที่มันมี field ที่เราไม่ต้องการ เราก็ไม่ต้องเลือกมัน อย่างเช่น ถ้าผมต้องการแค่ firstname และ age ผมก็เขียน query ออกมาแบบนี้</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript">query <span class="token punctuation">{</span>
  users<span class="token punctuation">{</span>
    firstname
    age
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>response ที่ได้</p>
<pre class="language-json" data-language="json"><code is:raw="" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"users"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Teerapat"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">34</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Mesut"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">31</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Bill"</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">65</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="working-with-existion-api">Working with existion API</h2>
<p>คราวนี้ผมจะเปลี่ยนจาก mock data ข้างบนมาใช้ <a href="https://punkapi.com/documentation/v2">brewdog punk api</a> ซึ่งผมต้องทำการแก้ไข <code>typeDefs</code> และ <code>query resolver</code> ก่อน โดยแก้ให้เป็นแบบนี้</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServer<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-server-micro'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> typeDefs <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  type Query {
    beers: [Beer!]!
  }
  type Beer {
    id: Int
    name: String
    tagline: String
    first_brewed: String
    description: String
    image_url: String
    abv: Float
    brewers_tips: String
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">Query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">beers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://api.punkapi.com/v2/beers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> beer <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

        <span class="token keyword">return</span> beer<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> apolloServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">api</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bodyParser</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> apolloServer<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/api/graphql'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>ลองไป query ดูใน graphql playground ครับ</p>
<p><img  src="/_assets/beers_playground.BFBIO_z8_1Q1dOn.webp" alt="beers" width="2362" height="1438" loading="lazy" decoding="async"></p>
<h2 id="fetch-data-in-client-side">Fetch data in client side</h2>
<p>หลังจากที่ Server ของเราเสร็จเป็นที่เรียบร้อยแล้ว ทีนี้ลองมาทำให้มันแสดงผลที่ฝั่ง frontend ดูบ้างครับ ผมจะให้ library <code>swr</code> เป็นตัวช่วย fetch data จาก graphql server นะครับ เบื้องต้น <code>swr</code> เป็น react hook ที่ช่วยอำนวยความสะดวกเราในการดึงข้อมูลจาก server โดยที่เราไม่ต้องใช้ <code>React.useEffect</code> เราสามรถใช้ <code>swr</code> กับ rest api ปกติก็ได้ ไม่จำเป็นว่าต้องเป็น graphql server ซึ่ง <code>swr</code> เองมีตัวช่วยเรื่อง <code>caching</code> หรือ <code>pagination</code> ด้วย จริงมันมีอะไรมากกว่านั้นอีก สามารถศึกษาเพิ่มเติมได้ที่ <a href="https://swr.vercel.app/">SWR</a> ครับ</p>
<p>คราวนี้เปิดไฟล์ <code>index.js</code> ขึ้นมาครับ ลบทุกอย่าง แต่ให้เหลือประมาณนี้</p>
<pre class="language-jsx" data-language="jsx"><code is:raw="" class="language-jsx"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'../styles/Home.module.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useSWR <span class="token keyword">from</span> <span class="token string">'swr'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">PUNK IPA</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ปกติแล้ว <code>useSWR</code> จะรับ 2 parameters เพื่อดึงข้อมูลมาจาก graphql server</p>
<ul>
<li><code>query</code></li>
<li><code>fetchData function</code></li>
</ul>
<p>โดยที่เขียน <code>query</code> และ <code>fetchData function</code> แบบนี้ จากนั้นลอง <code>console.log(data)</code> ออกมาดูครับ</p>
<pre class="language-jsx" data-language="jsx"><code is:raw="" class="language-jsx"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'../styles/Home.module.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useSWR <span class="token keyword">from</span> <span class="token string">'swr'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchBeer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">query</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/api/graphql'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    query {
      beers {
        id
        name
        tagline
        abv
        description
        image_url
      }
  }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    fetchBeer
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span>
        <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-5xl<span class="token punctuation">"</span></span>
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token literal-property property">paddingTop</span><span class="token operator">:</span> <span class="token string">'3rem'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">
        PUNK IPA
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>เราก็จะได้ข้อมูลกลับมาแบบนี้</p>
<p><img  src="/_assets/fetchData.CTSOA4Wn_C8dn9.webp" alt="fetch data" width="2224" height="1776" loading="lazy" decoding="async"></p>
<p>จากนั้นใครจะ render data ยังไง หรือจะ styling ยังไง อันนี้แล้วความชอบของแต่ละคนเลยนะครับ ผมเองมีตัวอย่างที่ทำเสร็จแล้ว ลองเข้าไปดูกันได้ที่ <a href="https://nextjs-graphql-omega.vercel.app/">Brewdog PUNK IPA</a> (ปล. ไม่สวยเลย ขออภัย 555555)</p>
<p>หวังว่าจะมีประโยชน์สำหรับใครที่กำลังศึกษาด้านนี้อยู่นะครับ โดยส่วนตัวผมค่อนข้างชอบ tools, library หรือ framework ที่ทีม developers ของ Next.js ทำออกมามาก มี product ดีๆ หลายตัวเลยทำให้เราสามารถสร้างหรือทดลองทำอะไรใหม่ๆ แล้วนำเสนอกับคนอื่นๆ ได้เร็วขึ้น สำหรับโพสต์นี้ ก็ขอจบลงเพียงเท่านี้นะครับ Happy Coding :)</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://nextjs.org/docs/api-routes/introduction">Next.js API Routes</a></li>
<li><a href="https://www.smashingmagazine.com/2020/10/graphql-server-next-javascript-api-routes/">How To Build A GraphQL Server Using Next.js API Routes</a></li>
<li><a href="https://swr.vercel.app/">SWR</a></li>
<li><a href="https://github.com/xeusteerapat/nextjs-graphql">Github Repo</a></li>
</ul>  </div> </article> <div class="comments-section" data-astro-cid-bvzihdzo> <section class="comments" data-astro-cid-on2fnc7p> <h2 class="comments-title" data-astro-cid-on2fnc7p>Comments</h2> <div class="giscus-container" data-astro-cid-on2fnc7p> <script src="https://giscus.app/client.js" data-repo="xeusteerapat/xeusteerapat.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyMTkyNTY4NzY=" data-category="General" data-category-id="DIC_kwDODRGYLM4COf8-" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script> </div> </section>  </div>  </main> </div> <footer class="footer" data-astro-cid-sz7xmlte> <div class="container-main footer-content" data-astro-cid-sz7xmlte> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://github.com/xeusteerapat" target="_blank" rel="noopener noreferrer" class="social-link" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>GitHub</span> <svg class="social-icon" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-sz7xmlte> <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://twitter.com/xeusteerapat" target="_blank" rel="noopener noreferrer" class="social-link" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Twitter</span> <svg class="social-icon" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-sz7xmlte> <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://www.linkedin.com/in/teerapat-prommarak/" target="_blank" rel="noopener noreferrer" class="social-link" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>LinkedIn</span> <svg class="social-icon" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-sz7xmlte> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> <p class="copyright" data-astro-cid-sz7xmlte>
Created by Teerapat Prommarak, © 2025 </p> </div> </footer>  </body></html> 